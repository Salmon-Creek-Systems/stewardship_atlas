<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>{title}</title>
    <script src='https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js'></script>
    <link href='https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css' rel='stylesheet' />
    <link href='css/map.css' rel='stylesheet' />
    <link href='css/shared_controls.css' rel='stylesheet' />
    <link href='css/console.css' rel='stylesheet' />
    <link href='https://www.unpkg.com/@watergis/maplibre-gl-legend@latest/dist/maplibre-gl-legend.css' rel='stylesheet' />
    <script src="https://www.unpkg.com/@watergis/maplibre-gl-legend@latest/dist/maplibre-gl-legend.umd.js"></script>

</head>
<body>
    <div id="controls">
        <!-- Title Panel -->
        <div class="control-panel title-panel">
            <h4>{title}</h4>
        </div>
        
        <!-- View Panel -->
        <div class="control-panel view-panel">
            <label>Basemap:</label>
            <select id="basemap-select" class="input-field">
                <option value="basemap">LIDAR Hillshade</option>
                <option value="satellite">Satellite (ESRI)</option>
                <option value="usgs">USGS Topo</option>
                <option value="terrain">OpenMapTiles Terrain</option>
            </select>
        </div>
        
        <!-- Sharing Panel -->
        <div class="control-panel sharing-panel">
            <label>Location sharing format:</label>
            <select id="coords-format-select" class="input-field">
                <option value="json">JSON coordinates</option>
                <option value="google">Google Maps link</option>
                <option value="internal">Internal map link</option>
            </select>
            <input type="text" id="location-input" class="input-field" placeholder="paste location here" style="width: calc(100% - 50px); display: inline-block;">
            <button id="go-location-btn" class="button" style="width: 40px; margin-left: 5px; padding: 5px;">Go</button>
        </div>
        
        <!-- Navigation Panel -->
        <div class="control-panel nav-panel">
            <a href="../html/admin" class="button link-button">Home</a>
            <a href="#" class="button link-button" id="help-link">?</a>
        </div>
        
        <!-- Progress Bar -->
        <div id="loading-progress" class="progress-bar">
            <div class="progress-fill"></div>
            <div class="progress-text">Loading layers...</div>
        </div>
    </div>
    <div id="map"></div>
    
    <!-- Help popup -->
    <div id="help-popup" class="help-popup" style="display: none;">
        <div class="help-content">
            <div class="help-header">
                <h2>Interactive Web Map Help</h2>
                <button id="close-help" class="close-button">&times;</button>
            </div>
            <div class="help-body">
                {webmap_help}
            </div>
        </div>
    </div>
    <script src="js/shared_utils.js"></script>
    <script>
        // Define constants for webmap
        const SATELLITE_SOURCE = {{
            'type': 'raster',
            'tiles': [
                'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{{z}}/{{y}}/{{x}}'
            ],
            'tileSize': 256,
            'attribution': 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
        }};
        const USGS_SOURCE = {{
            'type': 'raster',
            'tiles': [
                'https://basemap.nationalmap.gov/arcgis/rest/services/USGSTopo/MapServer/tile/{{z}}/{{y}}/{{x}}'
            ],
            'tileSize': 256,
            'attribution': 'Tiles courtesy of the U.S. Geological Survey'
        }};
        const TERRAIN_SOURCE = {{
            'type': 'raster',
            'tiles': [
                'https://tile.opentopomap.org/{{z}}/{{x}}/{{y}}.png'
            ],
            'tileSize': 256,
            'attribution': 'Map data: &copy; OpenStreetMap contributors, SRTM | Map style: &copy; OpenTopoMap (CC-BY-SA)'
        }};

        // Initialize the map
        const MAP_CONFIG = {map_config};
        const LEGEND_TARGETS = {legend_targets};
    </script>
    <script src="js/webmap.js"></script>
</body>
</html>